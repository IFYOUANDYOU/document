<view class="wrapper">
  <view class="topbar">
    <view class='item' style='margin-left:20rpx;'>
      <image src='../../image/marking/move.png'  wx:if="{{yes}}"></image>
      <image src='../../image/marking/move-active.png' wx:else></image>
      <view class='handle' bind:touchstart="yesup"  bind:touchend="yesdown" data-type="1"></view>
    </view>
    <view class='item'>
      <image src='../../image/marking/write.png' wx:if="{{close}}"></image>
      <image src='../../image/marking/write-active.png' wx:else></image>
      <view class='handle'  bind:touchstart="yesup"  bind:touchend="yesdown" data-type="2"></view>
    </view>
    <view class='item'>
      <image src='../../image/marking/text.png' wx:if="{{line}}"></image>
      <image src='../../image/marking/text-active.png' wx:else></image>
      <view class='handle'  bind:touchstart="yesup"  bind:touchend="yesdown" data-type="3"></view>
    </view>
    <view class='item'>
      <image src='../../image/marking/collect.png' wx:if="{{text}}"></image>
      <image src='../../image/marking/collect-active.png' wx:else></image>
      <view class='handle'  bind:touchstart="yesup"  bind:touchend="yesdown" data-type="4"></view>
    </view>
    <view class='item'>
      <image src='../../image/marking/papar.png' wx:if="{{clear}}"></image>
      <image src='../../image/marking/papar-active.png' wx:else></image>
      <view class='handle'  bind:touchstart="yesup"  bind:touchend="yesdown" data-type="5"></view>
    </view>
    <view class='select' catchtap='openStudent'>
      <view class='student_name'>
        <image src='{{swiper.imgUrls[swiper.current].studentNamePic[0].url}}' wx:if="{{swiper.imgUrls[swiper.current].studentNamePic.length>0}}"></image>
      </view>
      <view class='select_icon'>
        <image src='../../image/marking/down.png' style="width:25rpx;height:12rpx;transform:rotate({{show_student_list?180:0}}deg)"></image>
      </view>
      <view class='student_list' wx:if="{{show_student_list}}">
        <view class='list_img' wx:for="{{swiper.imgUrls}}" wx:key="{{index}}"  bindtap='selectStudentId' data-qid="{{item.questionId}}">
          <image src='{{item.studentNamePic[0].url}}' wx:if="{{item.studentNamePic.length>0 || item.studentNamePic[0].url}}"></image>
        </view>
      </view>
    </view>
  </view>
  <view class="float_bar {{float_type==2?'float_bar_text':''}}" wx:if="{{float_bar}}">
    <view class='f_bar' style='width:40rpx;height:37rpx' bindtap='clearArrData'>
      <image src='../../image/marking/rubber-active.png'></image>
    </view>
    <view class='f_bar'>
      <image src='../../image/marking/forward.png'></image>
    </view>
    <view class='f_bar'>
      <image src='../../image/marking/back.png'></image>
    </view>
  </view>
  <view class='_box' wx:if="{{testType!=1 && no_papar}}">
    <view class='pic'  bindtouchstart='EventHandleStart' bindtouchmove="EventMove" bindtouchend='EventHandle'>
      <view class="swiper-item {{index==swiper.current && swiper.swiper_type?'swiper-active':'swiper-actived'}}"  wx:for="{{swiper.imgUrls}}" wx:key="{{index}}" wx:if="{{swiper.current==index}}">
        <view wx:if="{{item.answerPostion.length>0}}">
          <image src="{{item.answerPostion[0].url +'?'+ oss_url}}" mode="aspectFit" bindload="imgload" class="slide-image"  style="width:{{imgload_width}}px;height:{{imgload_height}}px;"/>
        </view>
        <!-- <view wx:for="{{swiper.answer}}" wx:if="{{tabType==2}}" wx:key="{{index}}">
          <image src="{{item.url}}" mode="aspectFit" onLoad="imgload"  class="slide-image" style="width:{{imgload_width}}px;height:{{imgload_height}}px;transform:scale({{touch.scale}});"/>
        </view>
          
        <view wx:if="{{tabType==3}}" >
          <image src="{{swiper.standard}}"  mode="aspectFit" onLoad="imgload" style="width:{{imgload_width}}px;height:{{imgload_height}}px;transform:scale({{touch.scale}})" />
        </view> -->
      </view>
      <view class='textaras' wx:if="{{!textEnd && !line}}" style="top:{{t_top}}px;left:{{t_left}}px">
        <textarea  auto-height maxlength="50"  class='_input' adjust-position="false" bindblur="inputValue"  style='height:36rpx'/>
      </view>
      <!-- 输入完成后显示文字部分 -->
      <view class='_textara' style='top:{{item.y}}px;left:{{item.x}}px' wx:if="{{textData.length>0 }}" wx:for="{{textData}}" wx:key="{{index}}">
        <text>{{item.value}}</text>
      </view>
      <!-- 选择勾选图标，勾选完成后显示图标 -->
      <view class='error' wx:if="{{errorIconData.length>0}}">
        <view class="e_icon {{item.icon?'right_icon':''}}" style='top:{{item.y}}px;left:{{item.x}}px' wx:for="{{errorIconData}}" wx:key="{{index}}">
          <image src='../../image/marking/w_right.png' wx:if="{{item.icon === 3}}"></image>
          <image src='../../image/marking/alright.png' wx:if="{{item.icon === 2 && !item.score}}"></image>
          <view class='icon_num' wx:if="{{item.score || item.score ==0}}">{{item.score}}</view>
        </view>
      </view>
      <!-- 线条集合 -->
      <view class='canvasd' wx:if="{{canvasData.length>0 }}">
        <view class='can_line' wx:for="{{canvasData}}" wx:key="{{index}}" style='width:{{item.width}}px;top:{{item.top}}px;left:{{item.left}}px;transform:rotate({{item.deg}}deg)'></view>
      </view>
      <!-- <canvas class='myCanvas' canvas-id="myCanvas" bindtouchstart='EventHandleStart' bindtouchend='EventHandle' style="width: 100%; height: 100%;" bindtouchmove="textChange"   /> -->
    </view>
  </view>
  <view wx:if="{{!no_papar}}" class="nopic_view">
    <view class='no_pic' >
      <image src='../../image/marking/no_answer.png' mode="aspectFit"></image>
    </view>
    <view class='no_text' >阅完啦！</view>
  </view>
  
  <view class='keybar {{moreKeyCode?"moreCode":""}}' wx:if="{{testType!=1 && no_papar }}" >
    <!-- 打分键盘 -->
    <view class='keycode {{moreKeyCode?"moreKey":""}}'>
      <view class='code' wx:for="{{keyCode}}" wx:key="{{index}}" >
        <view class='code-text {{current == index?"text_active":""}}' bindtouchstart="keyups" bindtouchend="keydown" hover-class='keycode_active' data-index="{{item}}" wx:if="{{index != 61 && index != 62}}" >{{item}}</view>
        <!-- <image src='../../image/marking/code_active.png' wx:if="{{current == index && index != 61 && index != 62}}"></image>
        <image src='../../image/marking/keycode.png' wx:if="{{current != index && index != 61 && index != 62}}"></image> -->
        <!-- 键盘气泡 -->
        <view class='bubble' wx:if="{{current == index &&item != '···'}}">
        <!-- <view class='bubble'> -->
          <!-- <image src='../../image/marking/bubble.png'></image> -->
          <text>{{item_current}}</text>
        </view>
      </view>
      <!-- 占位按钮 -->
      <view class='empty' wx:for="{{keyCodeNum-keyCode.length}}" wx:key="{{item}}"></view>
      <!-- 收回按钮 -->
      <view class='retract' wx:if="{{moreKeyCode}}">
        <image src='../../image/marking/retract.png' wx:if="{{!r_model}}"></image>
        <image src='../../image/marking/retract-active.png' wx:else></image>
        <view class='r_model' bindtouchstart="retract" bindtouchend="retracting"></view>
      </view>
    </view>
    <!-- 打分浮圈 -->
    <!-- <view class='score'>
      <view class='score_bar {{item.value===""?(coreCurrent==index?"wait_bar":"dotted_bar"):""}}'  wx:for="{{answerArr}}" wx:key="{{index}}" wx:if="{{score_bar || answerArr.length>1}}">{{item.value}}</view>
    </view> -->
    <view class='magnifier' catchtap='enlargeHandle'>
      <image src='../../image/marking/enlarge.png'></image>
    </view>
  </view>
  <view class="actions" wx:if="{{!no_papar}}">
    <view class="btn b_btn" data-type="1" bind:touchstart="endHandle">
      <view class="icon_1">
        <image src="../../image/marking/_left.png"  />
      </view>
      <view class='b-tit'>回评本题</view>
    </view>
    <view class="btn b_btn"  data-type="2" bind:touchstart="endHandle">
      <view class='b-tit'>评阅下一题</view>
      <view class="icon_2">
        <image src="../../image/marking/_right.png"  />
      </view>
    </view>
  </view>
  
  
  <judge-comment extra="{{swiper}}" paparStatus="{{no_papar}}" wx:if="{{testType==1}}" bindonCounterPlusOne="onCounterPlusOne" bindbackHandle="backHandle"  bindenlarge="enlargeHandle" >
    <view class='pic'  bindtouchstart='EventHandleStart' bindtouchend='EventHandle'wx:if="{{no_papar}}">
      <view class="swiper-item {{index==swiper.current && swiper.swiper_type?'swiper-active':'swiper-actived'}}"  wx:for="{{swiper.imgUrls}}" wx:key="{{index}}" wx:if="{{swiper.current==index}}">
        <view wx:if="{{item.answerPostion.length>0}}">
          <!-- <view wx:for="{{swiper.answer}}" wx:key=="{{index}}">
            <image src="{{item.url}}" mode="aspectFit"  class="slide-image" style="height:60px;" data-img="{{index}}" />
          </view> -->
          <!-- <view style="display:flex;justify-content:flex-end;"> -->
            <image src="{{item.answerPostion[0].url +'?'+ oss_url}}" mode="aspectFit" class="slide-image"  bindload="imgload" style="width:{{imgload_width}}px;height:{{imgload_height}}px;"/>
          <!-- </view> -->
        </view>
      </view>
      <!-- 选择勾选图标，勾选完成后显示图标 -->
      <view class='error j-error' wx:if="{{errorIconData.length>0}}">
        <view class="e_icon {{item.icon?'right_icon':''}}" style='top:{{item.y}}px;left:{{item.x}}px' wx:for="{{errorIconData}}" wx:key="{{index}}">
          <image src='../../image/marking/w_right.png' wx:if="{{item.icon === 3}}"></image>
          <image src='../../image/marking/alright.png' wx:if="{{item.icon === 2 && !item.score}}"></image>
          <view class='icon_num' wx:if="{{item.score || item.score ==0}}">{{item.score}}</view>
        </view>
      </view>
    </view>
  </judge-comment>
    <view class="propModel  slideInUp" wx:if="{{topic_flag}}" >
      <view  class="prop_pic">
        <image src="{{answer_img}}" mode="aspectFit"  onLoad="imgload" style="width:{{imgload_width}}px;height:{{imgload_height}}px;"/>
      </view>
      <view class='close_btn' bindtap="closeAnswer">
        <view class='close_icon'>
          <image src='../../image/marking/etract.png'></image>
        </view>
        <view class='close_tit'>收起</view>
      </view>
    </view>
</view>
<!-- 横屏 ----------------------------------------------------------------->